(()=>{"use strict";function t(t,e,a){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove("".concat(a,"_disabled")),e.removeAttribute("disabled")):(e.classList.add("".concat(a,"_disabled")),e.setAttribute("disabled",!0))}var e,a,n={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-25","/"),params:{headers:{authorization:"8b127a1a-395e-48e9-a236-f106c6bfb4b6","Content-Type":"application/json"}}};function o(t,e){var a,o,r=(a=n,(o=Object.assign({},a)).params=Object.assign({},a.params),o.params.headers=Object.assign({},a.params.headers),o);for(var l in r.url=r.baseUrl+t,e)r.params[l]=e[l];return r}function r(t){return fetch(t.url,t.params).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))})).catch((function(t){console.log(t)}))}function l(){return r(o("users/me/",{method:"GET"}))}function c(t){"Escape"===t.key&&u(document.querySelector(".popup_opened"))}function i(t){document.addEventListener("keydown",c),t.classList.add("popup_opened")}function u(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function s(e,a,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];a.addEventListener("click",(function(){return function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.forEach((function(t){t.inputElement.value=t.initialValueContainer?t.initialValueContainer.textContent:t.fallbackInitialValue})),t(n.map((function(t){return t.inputElement})),e.querySelector(".".concat(a)),a),i(e)}(e,n,o)}))}function p(t,e){t.addEventListener("click",(function(a){(a.target.classList.contains(e)||a.target===a.currentTarget)&&u(t)}))}function d(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};t.querySelector(".".concat(e)).addEventListener("submit",(function(e){e.preventDefault(),a(),u(t)}))}function m(t,a,n,o){n.textContent=o.likes.length,o.likes.some((function(t){return t._id===e}))?t.classList.add("".concat(a,"_active")):t.classList.remove("".concat(a,"_active"))}function _(t){var a=t.targetGalleryCardTemplate.querySelector(".".concat(t.galleryCardClass)).cloneNode(!0);a.setAttribute("data-card-id",t.targetCardObject._id),a.querySelector(".".concat(t.cardTitleClass)).textContent=t.targetCardObject.name;var n=a.querySelector(".".concat(t.cardImageClass));n.alt=t.targetCardObject.name,n.src=t.targetCardObject.link,n.addEventListener("click",(function(){t.targetPopupDetailImage.src=t.targetCardObject.link,t.targetPopupDetailImage.alt=t.targetCardObject.name,t.targetPopupDetailCaption.textContent=t.targetCardObject.name,i(t.targetPopupDetail)}));var l=a.querySelector(".".concat(t.likeButtonClass)),c=a.querySelector(".".concat(t.likeButtonClass,"-count"));return m(l,t.likeButtonClass,c,t.targetCardObject),l.addEventListener("click",function(t,e,a){return function(n){var l;n.target.classList.contains("".concat(t,"_active"))?(l=n.target.closest(".".concat(a)).dataset.cardId,r(o("cards/likes/".concat(l),{method:"DELETE"}))).then((function(a){m(n.target,t,e,a)})).catch((function(t){console.log(t)})):function(t){return r(o("cards/likes/".concat(t),{method:"PUT"}))}(n.target.closest(".".concat(a)).dataset.cardId).then((function(a){m(n.target,t,e,a)})).catch((function(t){console.log(t)}))}}(t.likeButtonClass,c,t.galleryCardClass)),function(t,a,n,o,r,l){e!==a.owner._id?t.remove():s(o,t,l,[{inputElement:r,fallbackInitialValue:t.closest(".".concat(n)).dataset.cardId}])}(a.querySelector(".".concat(t.trashButtonClass)),t.targetCardObject,t.galleryCardClass,t.targetPopupPromptDelete,t.targetInputPromptDelete,t.submitButtonClass),a}l().then((function(t){e=t._id})).catch((function(t){console.log(t)})),a={targetInputClass:"popup__input",targetSubmitClass:"popup__submit"},Array.from(document.forms).forEach((function(e){return function(e,a){var n=Array.from(e.querySelectorAll(".".concat(a.targetInputClass))),o=e.querySelector(".".concat(a.targetSubmitClass));t(n,o,a.targetSubmitClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,a){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,a){var n=t.querySelector("#".concat(e.name,"-error"));e.classList.remove("".concat(a,"_invalid")),n.textContent=""}(t,e,a):function(t,e,a){var n=t.querySelector("#".concat(e.name,"-error"));e.classList.add("".concat(a,"_invalid")),n.textContent=e.validationMessage}(t,e,a)}(e,r,a.targetInputClass),t(n,o,a.targetSubmitClass)}))}))}(e,a)}));var f=document.querySelector(".profile__avatar"),g=document.querySelector(".profile__name"),y=document.querySelector(".profile__bio");l().then((function(t){f.src=t.avatar,g.textContent=t.name,y.textContent=t.about})).catch((function(t){console.log(t)}));var C=document.querySelector(".gallery__cards"),v=C.querySelector("#gallery__card").content,b=document.querySelector("#popup_type_detail"),h=b.querySelector(".popup__image"),S=b.querySelector(".popup__caption"),q=document.querySelector("#popup_type_remove"),k=document.forms.gallery__remove,E=k.elements.gallery__remove;r(o("cards/",{method:"GET"})).then((function(t){t.forEach((function(t){return C.append(_({targetCardObject:t,targetGalleryCardTemplate:v,targetPopupDetail:b,targetPopupDetailImage:h,targetPopupDetailCaption:S,targetPopupPromptDelete:q,targetInputPromptDelete:E,galleryCardClass:"gallery__card",cardTitleClass:"gallery__title",cardImageClass:"gallery__image",likeButtonClass:"gallery__like",trashButtonClass:"gallery__remove",submitButtonClass:"popup__submit"}))}))})).catch((function(t){console.log(t)}));var P=document.forms.profile__edit,I=P.elements.profile__name,x=P.elements.profile__bio,L=document.forms.profile__add,D=L.elements.gallery__title,O=L.elements.gallery__image,j=document.forms.profile__avatar,T=j.elements.profile__avatar,V=document.querySelector("#popup_type_edit"),B=document.querySelector("#profile__edit"),A=document.querySelector("#popup_type_add"),G=document.querySelector("#profile__add"),N=document.querySelector("#popup_type_avatar"),w=document.querySelector("#profile__change-avatar");s(V,B,"popup__submit",[{inputElement:I,initialValueContainer:g,fallbackInitialValue:""},{inputElement:x,initialValueContainer:y,fallbackInitialValue:""}]),s(A,G,"popup__submit",[{inputElement:D,fallbackInitialValue:""},{inputElement:O,fallbackInitialValue:""}]),s(N,w,"popup__submit",[{inputElement:T,fallbackInitialValue:""}]),p(b,"popup__close"),p(A,"popup__close"),p(N,"popup__close"),p(V,"popup__close"),p(q,"popup__close");var J=L.querySelector(".popup__submit"),M=k.querySelector(".popup__submit"),U=j.querySelector(".popup__submit"),H=P.querySelector(".popup__submit");d(A,"popup__form",(function(){var t,e,a=J.textContent;J.textContent="Добавляем...",(t=D.value,e=O.value,r(o("cards/",{method:"POST",body:JSON.stringify({name:t,link:e})}))).then((function(t){C.prepend(_({targetCardObject:t,targetGalleryCardTemplate:v,targetPopupDetail:b,targetPopupDetailImage:h,targetPopupDetailCaption:S,targetPopupPromptDelete:q,targetInputPromptDelete:E,galleryCardClass:"gallery__card",cardTitleClass:"gallery__title",cardImageClass:"gallery__image",likeButtonClass:"gallery__like",trashButtonClass:"gallery__remove",submitButtonClass:"popup__submit"}))})).catch((function(t){console.log(t)})).finally((function(){J.textContent=a,L.reset()}))})),d(N,"popup__form",(function(){var t,e=U.textContent;U.textContent="Сохраняем...",(t=T.value,r(o("users/me/avatar/",{method:"PATCH",body:JSON.stringify({avatar:t})}))).then((function(t){f.src=t.avatar})).catch((function(t){console.log(t)})).finally((function(){U.textContent=e,j.reset()}))})),d(V,"popup__form",(function(){var t,e,a=H.textContent;H.textContent="Сохраняем...",(t=I.value,e=x.value,r(o("users/me/",{method:"PATCH",body:JSON.stringify({name:t,about:e})}))).then((function(t){g.textContent=t.name,y.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){H.textContent=a,P.reset()}))})),d(q,"popup__form",(function(){var t,e=M.textContent;M.textContent="Удаляем...",(t=E.value,r(o("cards/".concat(t),{method:"DELETE"}))).then((function(){document.querySelector('[data-card-id="'.concat(E.value,'"]')).remove()})).catch((function(t){console.log(t)})).finally((function(){M.textContent=e,k.reset()}))}))})();